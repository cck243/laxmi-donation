<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Laxmi Temple Donation System</title>
  <!-- React -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <!-- Babel -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- jsPDF & html2canvas -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
</head>
<body class="bg-gray-100">
  <div id="root"></div>

  <!-- Hidden printable table for PDF -->
  <div id="printable-table" style="display:none; padding:20px; width:800px; font-family:Arial, sans-serif;">
    <h2 class="text-xl font-bold text-center mb-4">ðŸª” Shri Laxmi Temple â€” Donation Report</h2>
    <p class="text-center mb-2">Date: <span id="print-date"></span></p>
    <table style="width:100%; border-collapse:collapse; margin-top:10px;">
      <thead>
        <tr>
          <th style="border:1px solid #333; padding:6px; background:#f1f1f1;">Receipt</th>
          <th style="border:1px solid #333; padding:6px; background:#f1f1f1;">Name</th>
          <th style="border:1px solid #333; padding:6px; background:#f1f1f1;">Vehicle</th>
          <th style="border:1px solid #333; padding:6px; background:#f1f1f1;">Mobile</th>
          <th style="border:1px solid #333; padding:6px; background:#f1f1f1;">Amount (â‚¹)</th>
          <th style="border:1px solid #333; padding:6px; background:#f1f1f1;">Time</th>
        </tr>
      </thead>
      <tbody id="print-rows"></tbody>
    </table>
    <p class="mt-4 text-right">Total: â‚¹<span id="print-total"></span></p>
  </div>

  <script type="text/babel">
    const { useState, useMemo } = React;
    const { jsPDF } = window.jspdf;

    // --- Icons (same as before) ---
    const FileText = (props) => (
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}>
        <path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z" />
        <polyline points="14 2 14 8 20 8" />
        <line x1="16" x2="8" y1="13" y2="13" />
        <line x1="16" x2="8" y1="17" y2="17" />
        <line x1="10" x2="8" y1="9" y2="9" />
      </svg>
    );

    const Download = (props) => (
      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}>
        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
        <polyline points="7 10 12 15 17 10" />
        <line x1="12" x2="12" y1="15" y2="3" />
      </svg>
    );

    // Other icons (User, Car, etc.) â€” keep as in your original code
    // For brevity, only showing essential parts

    function TempleDonationApp() {
      const [formData, setFormData] = useState({
        donorName: '',
        vehicleNumber: '',
        mobileNumber: '',
        amount: ''
      });

      const [donations, setDonations] = useState([]);
      const [filterDate, setFilterDate] = useState(new Date().toISOString().split('T')[0]);

      const handleInputChange = (field, value) => {
        setFormData(prev => ({ ...prev, [field]: value }));
      };

      const handleSubmit = () => {
        const { donorName, amount } = formData;
        if (!donorName || !amount) {
          alert('Donor Name and Amount are required.');
          return;
        }

        const receiptNumber = `LT${Date.now().toString().slice(-8)}`;
        const now = new Date();
        const newDonation = {
          ...formData,
          receiptNumber,
          date: now.toLocaleDateString('en-IN'),
          isoDate: now.toISOString().split('T')[0],
          time: now.toLocaleTimeString('en-IN')
        };

        setDonations(prev => [newDonation, ...prev]);
        setFormData({ donorName: '', vehicleNumber: '', mobileNumber: '', amount: '' });
      };

      const filteredDonations = useMemo(() => {
        return donations.filter(d => d.isoDate === filterDate);
      }, [donations, filterDate]);

      const totalDonations = filteredDonations.reduce((sum, d) => sum + parseFloat(d.amount || 0), 0);

      // --- PDF Download ---
      const downloadPDF = async () => {
        if (filteredDonations.length === 0) {
          alert('No data to export.');
          return;
        }

        const printDateEl = document.getElementById('print-date');
        const printRowsEl = document.getElementById('print-rows');
        const printTotalEl = document.getElementById('print-total');

        // Set date
        const displayDate = filterDate === new Date().toISOString().split('T')[0] 
          ? 'Today' 
          : new Date(filterDate).toLocaleDateString('en-IN');
        printDateEl.textContent = displayDate;

        // Clear and populate rows
        printRowsEl.innerHTML = '';
        filteredDonations.forEach(d => {
          const row = document.createElement('tr');
          row.innerHTML = `
            <td style="border:1px solid #333; padding:6px;">${d.receiptNumber}</td>
            <td style="border:1px solid #333; padding:6px;">${d.donorName}</td>
            <td style="border:1px solid #333; padding:6px;">${d.vehicleNumber || 'â€”'}</td>
            <td style="border:1px solid #333; padding:6px;">${d.mobileNumber || 'â€”'}</td>
            <td style="border:1px solid #333; padding:6px;">${parseFloat(d.amount).toLocaleString('en-IN')}</td>
            <td style="border:1px solid #333; padding:6px;">${d.time}</td>
          `;
          printRowsEl.appendChild(row);
        });

        printTotalEl.textContent = totalDonations.toLocaleString('en-IN');

        const element = document.getElementById('printable-table');
        const canvas = await html2canvas(element);
        const imgData = canvas.toDataURL('image/png');
        const pdf = new jsPDF('p', 'mm', 'a4');
        const width = pdf.internal.pageSize.getWidth();
        const height = (canvas.height * width) / canvas.width;
        pdf.addImage(imgData, 'PNG', 0, 0, width, Math.min(height, 297));
        pdf.save(`LaxmiTemple_Donations_${filterDate}.pdf`);
      };

      // --- CSV (Excel) Download ---
      const downloadCSV = () => {
        if (filteredDonations.length === 0) {
          alert('No data to export.');
          return;
        }

        const headers = ['Receipt', 'Name', 'Vehicle', 'Mobile', 'Amount', 'Date', 'Time'];
        const rows = filteredDonations.map(d => [
          d.receiptNumber,
          `"${d.donorName}"`,
          d.vehicleNumber || '',
          d.mobileNumber || '',
          d.amount,
          d.date,
          d.time
        ]);

        let csvContent = 'data:text/csv;charset=utf-8,';
        csvContent += headers.join(',') + '\n';
        csvContent += rows.map(e => e.join(',')).join('\n');

        const encodedUri = encodeURI(csvContent);
        const link = document.createElement('a');
        link.setAttribute('href', encodedUri);
        link.setAttribute('download', `LaxmiTemple_Donations_${filterDate}.csv`);
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
      };

      return (
        <div className="min-h-screen bg-gradient-to-br from-orange-50 via-yellow-50 to-red-50">
          <div className="container mx-auto px-4 py-8 max-w-6xl">
            {/* Header */}
            <div className="bg-gradient-to-r from-orange-600 to-red-600 rounded-lg shadow-xl p-6 mb-8 text-white">
              <h1 className="text-3xl font-bold text-center mb-2">ðŸª” Shri Laxmi Temple</h1>
              <p className="text-center text-orange-100">Vehicle Donation Collection System</p>
            </div>

            <div className="grid md:grid-cols-2 gap-8">
              {/* Form */}
              <div className="bg-white rounded-lg shadow-lg p-6">
                <h2 className="text-2xl font-bold text-orange-700 mb-6 flex items-center gap-2">
                  <FileText className="w-6 h-6" /> Donation Entry
                </h2>
                {/* ... form fields ... (same as before) */}
                <div className="space-y-4">
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">Donor Name *</label>
                    <input
                      type="text"
                      value={formData.donorName}
                      onChange={(e) => handleInputChange('donorName', e.target.value)}
                      className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500"
                      placeholder="Enter donor name"
                    />
                  </div>
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">Vehicle Number (Optional)</label>
                    <input
                      type="text"
                      value={formData.vehicleNumber}
                      onChange={(e) => handleInputChange('vehicleNumber', e.target.value.toUpperCase())}
                      className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 uppercase"
                      placeholder="e.g. TN01AB1234"
                    />
                  </div>
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">Mobile Number (Optional)</label>
                    <input
                      type="tel"
                      value={formData.mobileNumber}
                      onChange={(e) => handleInputChange('mobileNumber', e.target.value)}
                      className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500"
                      placeholder="e.g. 9876543210"
                      maxLength="10"
                    />
                  </div>
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">Donation Amount (â‚¹) *</label>
                    <input
                      type="number"
                      value={formData.amount}
                      onChange={(e) => handleInputChange('amount', e.target.value)}
                      className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500"
                      placeholder="Enter amount"
                      min="1"
                    />
                  </div>
                  <button
                    onClick={handleSubmit}
                    className="w-full bg-gradient-to-r from-orange-600 to-red-600 text-white py-3 rounded-lg font-semibold hover:from-orange-700 hover:to-red-700 transition-all shadow-md"
                  >
                    Submit Donation
                  </button>
                </div>
              </div>

              {/* Donations List with Export Buttons */}
              <div className="bg-white rounded-lg shadow-lg p-6">
                <div className="flex justify-between items-center mb-4">
                  <h2 className="text-2xl font-bold text-orange-700">Donations</h2>
                  <div className="flex gap-2">
                    <button
                      onClick={downloadPDF}
                      className="text-sm bg-red-600 text-white px-3 py-1 rounded flex items-center gap-1 hover:bg-red-700"
                    >
                      <Download className="w-4 h-4" /> PDF
                    </button>
                    <button
                      onClick={downloadCSV}
                      className="text-sm bg-green-600 text-white px-3 py-1 rounded flex items-center gap-1 hover:bg-green-700"
                    >
                      <Download className="w-4 h-4" /> Excel
                    </button>
                  </div>
                </div>

                <div className="mb-4">
                  <label className="block text-sm font-medium text-gray-700 mb-1">Filter by Date</label>
                  <input
                    type="date"
                    value={filterDate}
                    onChange={(e) => setFilterDate(e.target.value)}
                    className="px-3 py-1 border border-gray-300 rounded focus:ring-2 focus:ring-orange-500"
                  />
                </div>

                <div className="bg-gradient-to-r from-green-500 to-green-600 text-white rounded-lg p-4 mb-4">
                  <p className="text-sm opacity-90">Total Collected</p>
                  <p className="text-2xl font-bold">â‚¹ {totalDonations.toLocaleString('en-IN')}</p>
                  <p className="text-sm opacity-90">{filteredDonations.length} donations</p>
                </div>

                <div className="space-y-3 max-h-96 overflow-y-auto">
                  {filteredDonations.length === 0 ? (
                    <p className="text-gray-500 text-center py-8">No donations on this date</p>
                  ) : (
                    filteredDonations.map((d, i) => (
                      <div key={i} className="border border-gray-200 rounded p-3">
                        <div className="flex justify-between">
                          <span className="font-medium">{d.donorName}</span>
                          <span className="text-green-600 font-bold">â‚¹{d.amount}</span>
                        </div>
                        {d.vehicleNumber && <p className="text-xs text-gray-600">{d.vehicleNumber}</p>}
                        <p className="text-xs text-gray-500">{d.date} {d.time} â€¢ {d.receiptNumber}</p>
                      </div>
                    ))
                  )}
                </div>
              </div>
            </div>
          </div>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<TempleDonationApp />);
  </script>
</body>
</html>
