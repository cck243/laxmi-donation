<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Laxmi Temple Donation System</title>
  <!-- React -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <!-- Babel -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- jsPDF for PDF generation (optional) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <!-- html2canvas for PDF (optional) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
</head>
<body class="bg-gray-100">
  <div id="root"></div>

  <!-- Hidden receipt template for PDF -->
  <div id="receipt-template" style="display:none; padding:20px; width:400px; font-family:monospace; background:white;">
    <p>🪔 Shri Laxmi Temple</p>
    <p>━━━━━━━━━━━━━━━━</p>
    <p><strong>Receipt:</strong> <span id="rt-receipt"></span></p>
    <p><strong>Name:</strong> <span id="rt-name"></span></p>
    <p><strong>Vehicle:</strong> <span id="rt-vehicle"></span></p>
    <p><strong>Amount:</strong> ₹<span id="rt-amount"></span></p>
    <p><strong>Date:</strong> <span id="rt-date"></span></p>
    <p>━━━━━━━━━━━━━━━━</p>
    <p>Thank you for your donation!</p>
    <p>May Goddess Laxmi bless you 🙏</p>
  </div>

  <script type="text/babel">
    const { useState, useMemo, useRef } = React;
    const { jsPDF } = window.jspdf;

    // --- Icons (same as before) ---
    const Phone = (props) => (
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}>
        <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z" />
      </svg>
    );

    const Car = (props) => (
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}>
        <path d="M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9C18.7 10.6 16 10 16 10s-1.3-1.4-2.2-2.3c-.5-.4-1.1-.7-1.8-.7H5c-.6 0-1.1.4-1.4.9l-1.4 2.9A3.7 3.7 0 0 0 2 12v4c0 .6.4 1 1 1h2" />
        <circle cx="7" cy="17" r="2" />
        <path d="M9 17h6" />
        <circle cx="17" cy="17" r="2" />
      </svg>
    );

    const User = (props) => (
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}>
        <path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2" />
        <circle cx="12" cy="7" r="4" />
      </svg>
    );

    const IndianRupee = (props) => (
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}>
        <path d="M6 3h12" />
        <path d="M6 8h12" />
        <path d="m6 13 8.5 8" />
        <path d="M6 13h3" />
        <path d="M9 13c6.667 0 6.667-10 0-10" />
      </svg>
    );

    const Send = (props) => (
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}>
        <path d="m22 2-7 20-4-9-9-4Z" />
        <path d="M22 2 11 13" />
      </svg>
    );

    const CheckCircle = (props) => (
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}>
        <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" />
        <polyline points="22 4 12 14.01 9 11.01" />
      </svg>
    );

    const FileText = (props) => (
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}>
        <path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z" />
        <polyline points="14 2 14 8 20 8" />
        <line x1="16" x2="8" y1="13" y2="13" />
        <line x1="16" x2="8" y1="17" y2="17" />
        <line x1="10" x2="8" y1="9" y2="9" />
      </svg>
    );

    const AlertTriangle = (props) => (
      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}>
        <path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z" />
        <line x1="12" x2="12" y1="9" y2="13" />
        <line x1="12" x2="12.01" y1="17" y2="17" />
      </svg>
    );

    function TempleDonationApp() {
      const [formData, setFormData] = useState({
        donorName: '',
        vehicleNumber: '',
        mobileNumber: '',
        amount: ''
      });

      const [donations, setDonations] = useState([]);
      const [receiptSent, setReceiptSent] = useState(false);
      const [currentReceipt, setCurrentReceipt] = useState(null);
      const [filterDate, setFilterDate] = useState(new Date().toISOString().split('T')[0]);
      const [duplicateWarning, setDuplicateWarning] = useState(false);

      const todayDonations = useMemo(() => {
        return donations.filter(d => d.isoDate === new Date().toISOString().split('T')[0]);
      }, [donations]);

      const handleInputChange = (field, value) => {
        setFormData(prev => ({ ...prev, [field]: value }));
        // Clear duplicate warning on change
        if (field === 'donorName' || field === 'vehicleNumber') {
          setDuplicateWarning(false);
        }
      };

      const isDuplicate = () => {
        const { donorName, vehicleNumber } = formData;
        if (!donorName && !vehicleNumber) return false;
        return todayDonations.some(d =>
          d.donorName.toLowerCase() === donorName.toLowerCase() &&
          d.vehicleNumber.toLowerCase() === vehicleNumber.toLowerCase()
        );
      };

      const generateReceiptNumber = () => {
        return `LT${Date.now().toString().slice(-8)}`;
      };

      const generateWhatsAppMessage = (receipt) => {
        const msg = `🪔 *Shri Laxmi Temple*\n\n` +
          `*Receipt:* ${receipt.receiptNumber}\n` +
          `*Name:* ${receipt.donorName}\n` +
          (receipt.vehicleNumber ? `*Vehicle:* ${receipt.vehicleNumber}\n` : '') +
          `*Amount:* ₹${receipt.amount}\n` +
          `*Date:* ${receipt.date}\n\n` +
          `Thank you for your donation!\nMay Goddess Laxmi bless you 🙏`;
        return encodeURIComponent(msg);
      };

      const handleWhatsAppShare = () => {
        if (!currentReceipt?.mobileNumber) {
          alert('Mobile number is required to share via WhatsApp.');
          return;
        }
        const cleanNumber = currentReceipt.mobileNumber.replace(/\D/g, '');
        if (cleanNumber.length !== 10) {
          alert('Please enter a valid 10-digit mobile number.');
          return;
        }
        const waUrl = `https://wa.me/91${cleanNumber}?text=${generateWhatsAppMessage(currentReceipt)}`;
        window.open(waUrl, '_blank');
      };

      const downloadPDF = async () => {
        const rt = document.getElementById('receipt-template');
        if (!rt || !currentReceipt) return;

        // Fill template
        document.getElementById('rt-receipt').textContent = currentReceipt.receiptNumber;
        document.getElementById('rt-name').textContent = currentReceipt.donorName;
        document.getElementById('rt-vehicle').textContent = currentReceipt.vehicleNumber || '—';
        document.getElementById('rt-amount').textContent = currentReceipt.amount;
        document.getElementById('rt-date').textContent = currentReceipt.date;

        const canvas = await html2canvas(rt);
        const imgData = canvas.toDataURL('image/png');
        const pdf = new jsPDF('p', 'mm', 'a5');
        const width = pdf.internal.pageSize.getWidth();
        const height = (canvas.height * width) / canvas.width;
        pdf.addImage(imgData, 'PNG', 0, 0, width, height);
        pdf.save(`LaxmiTemple_Receipt_${currentReceipt.receiptNumber}.pdf`);
      };

      const handleSubmit = () => {
        const { donorName, amount } = formData;
        if (!donorName || !amount) {
          alert('Donor Name and Amount are required.');
          return;
        }

        if (isDuplicate()) {
          setDuplicateWarning(true);
          return;
        }

        const receiptNumber = generateReceiptNumber();
        const now = new Date();
        const newDonation = {
          ...formData,
          receiptNumber,
          date: now.toLocaleDateString('en-IN'),
          isoDate: now.toISOString().split('T')[0],
          time: now.toLocaleTimeString('en-IN')
        };

        setDonations(prev => [newDonation, ...prev]);
        setCurrentReceipt(newDonation);
        setReceiptSent(true);
        setDuplicateWarning(false);

        setTimeout(() => {
          setReceiptSent(false);
          setCurrentReceipt(null);
        }, 8000);

        setFormData({ donorName: '', vehicleNumber: '', mobileNumber: '', amount: '' });
      };

      const filteredDonations = useMemo(() => {
        return donations.filter(d => d.isoDate === filterDate);
      }, [donations, filterDate]);

      const totalDonations = filteredDonations.reduce((sum, d) => sum + parseFloat(d.amount || 0), 0);

      return (
        <div className="min-h-screen bg-gradient-to-br from-orange-50 via-yellow-50 to-red-50">
          <div className="container mx-auto px-4 py-8 max-w-6xl">
            <div className="bg-gradient-to-r from-orange-600 to-red-600 rounded-lg shadow-xl p-6 mb-8 text-white">
              <h1 className="text-3xl font-bold text-center mb-2">🪔 Shri Laxmi Temple</h1>
              <p className="text-center text-orange-100">Vehicle Donation Collection System</p>
            </div>

            <div className="grid md:grid-cols-2 gap-8">
              {/* Donation Form */}
              <div className="bg-white rounded-lg shadow-lg p-6">
                <h2 className="text-2xl font-bold text-orange-700 mb-6 flex items-center gap-2">
                  <FileText className="w-6 h-6" /> Donation Entry
                </h2>

                {duplicateWarning && (
                  <div className="mb-4 p-3 bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 flex items-start gap-2">
                    <AlertTriangle className="mt-0.5 flex-shrink-0" />
                    <span><strong>Possible duplicate!</strong> Same name and vehicle already donated today.</span>
                  </div>
                )}

                <div className="space-y-4">
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">
                      <User className="w-4 h-4 inline mr-2" /> Donor Name *
                    </label>
                    <input
                      type="text"
                      value={formData.donorName}
                      onChange={(e) => handleInputChange('donorName', e.target.value)}
                      className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent"
                      placeholder="Enter donor name"
                    />
                  </div>

                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">
                      <Car className="w-4 h-4 inline mr-2" /> Vehicle Number (Optional)
                    </label>
                    <input
                      type="text"
                      value={formData.vehicleNumber}
                      onChange={(e) => handleInputChange('vehicleNumber', e.target.value.toUpperCase())}
                      className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent uppercase"
                      placeholder="e.g. TN01AB1234"
                    />
                  </div>

                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">
                      <Phone className="w-4 h-4 inline mr-2" /> Mobile Number (Optional)
                    </label>
                    <input
                      type="tel"
                      value={formData.mobileNumber}
                      onChange={(e) => handleInputChange('mobileNumber', e.target.value)}
                      className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent"
                      placeholder="e.g. 9876543210"
                      maxLength="10"
                    />
                  </div>

                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">
                      <IndianRupee className="w-4 h-4 inline mr-2" /> Donation Amount (₹) *
                    </label>
                    <input
                      type="number"
                      value={formData.amount}
                      onChange={(e) => handleInputChange('amount', e.target.value)}
                      className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent"
                      placeholder="Enter amount"
                      min="1"
                    />
                  </div>

                  <button
                    onClick={handleSubmit}
                    className="w-full bg-gradient-to-r from-orange-600 to-red-600 text-white py-3 rounded-lg font-semibold hover:from-orange-700 hover:to-red-700 transition-all shadow-md flex items-center justify-center gap-2"
                  >
                    <Send className="w-5 h-5" /> Submit & Generate Receipt
                  </button>
                </div>

                {receiptSent && currentReceipt && (
                  <div className="mt-4 bg-green-50 border-2 border-green-500 rounded-lg p-4">
                    <div className="flex items-center gap-2 text-green-700 font-semibold mb-2">
                      <CheckCircle className="w-5 h-5" /> Receipt Generated!
                    </div>
                    <p className="text-sm text-green-600">
                      <strong>{currentReceipt.donorName}</strong> donated ₹{currentReceipt.amount}
                    </p>
                    <p className="text-xs text-green-600">
                      Receipt: {currentReceipt.receiptNumber} • {currentReceipt.date}
                    </p>
                    <div className="mt-3 flex gap-2">
                      {currentReceipt.mobileNumber && (
                        <button
                          onClick={handleWhatsAppShare}
                          className="text-sm bg-green-600 text-white px-3 py-1 rounded hover:bg-green-700"
                        >
                          Share via WhatsApp
                        </button>
                      )}
                      <button
                        onClick={downloadPDF}
                        className="text-sm bg-blue-600 text-white px-3 py-1 rounded hover:bg-blue-700"
                      >
                        Download PDF
                      </button>
                    </div>
                  </div>
                )}
              </div>

              {/* Donations List */}
              <div className="bg-white rounded-lg shadow-lg p-6">
                <div className="flex justify-between items-center mb-4">
                  <h2 className="text-2xl font-bold text-orange-700">Donations</h2>
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-1">Filter by Date</label>
                    <input
                      type="date"
                      value={filterDate}
                      onChange={(e) => setFilterDate(e.target.value)}
                      className="px-3 py-1 border border-gray-300 rounded focus:ring-2 focus:ring-orange-500 focus:border-transparent"
                    />
                  </div>
                </div>

                <div className="bg-gradient-to-r from-green-500 to-green-600 text-white rounded-lg p-4 mb-6">
                  <p className="text-sm opacity-90">Total Collected</p>
                  <p className="text-3xl font-bold">₹ {totalDonations.toLocaleString('en-IN')}</p>
                  <p className="text-sm opacity-90">{filteredDonations.length} donations</p>
                </div>

                <div className="space-y-3 max-h-96 overflow-y-auto">
                  {filteredDonations.length === 0 ? (
                    <p className="text-gray-500 text-center py-8">No donations on this date</p>
                  ) : (
                    filteredDonations.map((donation, index) => (
                      <div key={`${donation.receiptNumber}-${index}`} className="border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow">
                        <div className="flex justify-between items-start mb-2">
                          <div>
                            <p className="font-semibold text-gray-800">{donation.donorName}</p>
                            {donation.vehicleNumber && <p className="text-sm text-gray-600">{donation.vehicleNumber}</p>}
                          </div>
                          <p className="text-lg font-bold text-green-600">₹{donation.amount}</p>
                        </div>
                        <div className="flex justify-between items-center text-xs text-gray-500">
                          {donation.mobileNumber && <span>{donation.mobileNumber}</span>}
                          <span>{donation.date} {donation.time}</span>
                        </div>
                        <p className="text-xs text-gray-400 mt-1">Receipt: {donation.receiptNumber}</p>
                      </div>
                    ))
                  )}
                </div>
              </div>
            </div>
          </div>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<TempleDonationApp />);
  </script>
</body>
</html>
